### Arch Installation Tool - Currently for Non-EFI Only
pacman -Sy --noconfirm pacman-contrib dialog
### Sets Time
timedatectl set-ntp true
### Disk Selection Menu
devicelist=$(lsblk -dplnx size -o name,size | grep -Ev "boot|rpmb|loop" | tac)
device=$(dialog --stdout --menu "Select installtion disk" 0 0 0 ${devicelist}) || exit 1
clear
### Automatic Formatting
parted --script "${device}" -- mklabel msdos \
  mkpart ESP ext4 1Mib 129MiB \
  set 1 boot on \
  mkpart primary ext4 129MiB 100%
part_boot="$(ls ${device}* | grep -E "^${device}p?1$")"
part_root="$(ls ${device}* | grep -E "^${device}p?2$")"
wipefs "${part_boot}"
wipefs "${part_root}"
mkfs.ext4 "${part_boot}"
mkfs.ext4 "${part_root}"
mount "${part_root}" /mnt
mkdir /mnt/boot
mount "${part_boot}" /mnt/boot
### Install and set up of Arch
pacstrap /mnt base base-devel linux linux-firmware vim
genfstab -U /mnt >> /mnt/etc/fstab
arch-chroot /mnt /bin/bash
pacman -S networkmanager grub
systemctl enable NetworkManager
grub-install /dev/sda
grub-mkconfig - o /boot/grub/grub.cfg
password=$(dialog --stdout --passwordbox "Enter admin password" 0 0) || exit 1
clear
: ${password:?"password cannot be empty"}
password2=$(dialog --stdout --passwordbox "Enter admin password again" 0 0) || exit 1
clear
[[ "$password" == "$password2" ]] || ( echo "Passwords did not match"; exit 1; )
echo "root:$password" | chpasswd --root /mnt
echo "LANG=en_GB.UTF-8" > /mnt/etc/locale.conf
ln -sf /usr/share/zoneinfo/America/Detroit /etc/localtime
exit
umount -R /mnt
reboot





